""""""""""""""""""""""""""""""
" Plugin management
call plug#begin()

Plug 'hzchirs/vim-material'
Plug 'godlygeek/tabular'

" Syntax support
Plug 'plasticboy/vim-markdown'
Plug 'JamshedVesuna/vim-markdown-preview'
Plug 'cespare/vim-toml'

" Python
Plug 'vim-scripts/indentpython.vim'
Plug 'vim-syntastic/syntastic'
Plug 'nvie/vim-flake8'
Plug 'plytophogy/vim-virtualenv'

" Just a shitload of color schemes.
" https://github.com/flazz/vim-colorschemes#current-colorschemes
Plug 'flazz/vim-colorschemes'

" Fuzzy finder -- absolutely must have.
Plug 'kien/ctrlp.vim'

" Support for easily toggling comments.
Plug 'tpope/vim-commentary'

" Proper JSON filetype detection, and support.
Plug 'leshill/vim-json'

" Ansible yaml
Plug 'chase/vim-ansible-yaml'

" git wrapper
Plug 'tpope/vim-fugitive'

" directory tree with git support
Plug 'scrooloose/nerdtree'
Plug 'Xuyuanp/nerdtree-git-plugin'

" airline statusline
Plug 'bling/vim-airline'

" vim surround
Plug 'tpope/vim-surround'

" LanguageServer support
Plug 'autozimu/LanguageClient-neovim', {
    \ 'branch': 'next',
    \ 'do': 'bash install.sh',
    \ }
Plug 'junegunn/fzf'

" Auto completion
if has('nvim')
  Plug 'Shougo/deoplete.nvim', { 'do': ':UpdateRemotePlugins' }
else
  Plug 'Shougo/deoplete.nvim'
  Plug 'roxma/nvim-yarp'
  Plug 'roxma/vim-hug-neovim-rpc'
endif

call plug#end()

" Load the base vim configuration
source ~/.vim/vimrcbase

" Use sane regex's when searching
nnoremap / /\v
vnoremap / /\v

" Prefer tabs instead of buffers
set switchbuf=usetab,newtab

" We have VCS -- we don't need this stuff.
set nobackup " We have vcs, we don't need backups.
set nowritebackup " We have vcs, we don't need backups.
set noswapfile " They're just annoying. Who likes them?

" Set the copy buffer to be CLIPBOARD
set clipboard=unnamedplus

" Enable folding with za
set foldmethod=indent
set foldlevel=99

" Generic
set nu
set fileformat=unix

" Python settings
au BufNewFile,BufRead *.py
    \ set tabstop=4 |
    \ set softtabstop=4 |
    \ set shiftwidth=4 |
    \ set expandtab |
    \ set autoindent
highlight BadWhitespace ctermbg=red guibg=darkred
au BufNewFile,BufRead *.py,*.pyw,*.c,*.h match BadWhitespace /\s\+$/
set encoding=utf-8

" Jenkinsfile
au BufNewFile,BufRead Jenkinsfile setf groovy

" Yaml files
au BufNewFile,BufRead *.yml,*.yaml
	\ set tabstop=2 |
    \ set softtabstop=2 |
    \ set shiftwidth=2 |
	\ set expandtab |
	\ set autoindent

""""""""""""""""""""""""""""""
" Plugin settings            "
""""""""""""""""""""""""""""""

" Configure NERDTree
autocmd StdinReadPre * let s:std_in=1
autocmd VimEnter * if argc() == 1 && isdirectory(argv()[0]) && !exists("s:std_in") | exe 'NERDTree' argv()[0] | wincmd p | ene | endif
nnoremap <C-n> :NERDTreeToggle<CR>
let NERDTreeMinimalUI = 1
let NERDTreeShowHidden = 1
let NERDTreeIgnore=['\.pyc$', '\~$']

" Set the maximum number of CtrlP results
let g:ctrlp_max_height = 15
nnoremap <A-p> :<C-U>CtrlPBuffer<CR>
set wildignore+=*.pyc

" Finally the color scheme. Choose whichever you want from the list in the
" link above (back up where we included the bundle of a ton of themes.)
if isdirectory("~/.vim/bundle/vim-material")
    colorscheme vim-material
endif

" LanguageClient configuration
" Required for operations modifying multiple buffers like rename.
set hidden

let g:LanguageClient_serverCommands = {'python': ['pyls']}

nnoremap <F5> :call LanguageClient_contextMenu()<CR>
" Or map each action separately
nnoremap <silent> K :call LanguageClient#textDocument_hover()<CR>
nnoremap <silent> gd :call LanguageClient#textDocument_definition()<CR>
nnoremap <silent> <F2> :call LanguageClient#textDocument_rename()<CR>

" deoplete configuration
let g:deoplete#enable_at_startup = 1

